<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Global Notes Workspace</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="CSS/index.css?v=13" />
  <link rel="stylesheet" href="CSS/tagManager.css" />
  <link rel="manifest" href="/manifest.json">
  <script>
    // Force Redirect from 0.0.0.0 to localhost to ensure Secure Context
    if (window.location.hostname === '0.0.0.0') {
      window.location.hostname = 'localhost';
    }
  </script>
</head>

<body>
  <header class="app-header">
    <div class="header-row">
      <div class="brand">
        <button class="btn-icon" id="sidebar-toggle" aria-label="Toggle sidebar" style="margin-right: 8px;">‚ò∞</button>
        <img src="assets/images/logo.png" alt="Global Notes" class="logo-img">
        <h1>Global Notes Workspace</h1>
      </div>

      <div class="search">
        <input type="search" id="search" class="search-input" placeholder="Search notes by title, text, or tags‚Ä¶"
          aria-label="Search notes" />
      </div>

      <div class="auth-controls">
        <div class="user-pill hidden" id="user-pill" aria-live="polite" role="button" tabindex="0"
          aria-label="View Profile">
          <img id="header-avatar" class="header-avatar" src="" alt="" aria-hidden="true" />
          <span class="user-name" id="user-name"></span>
          <button class="btn tiny" id="logout">Log out</button>
        </div>
        <button class="btn ghost" id="login">Sign In</button>
        <button class="btn primary" id="export">Export</button>
      </div>
    </div>

    <div class="header-toolbar">
      <div class="filters">
        <button class="chip active" data-filter="all" aria-pressed="true">All</button>
        <button class="chip" data-filter="work">Work</button>
        <button class="chip" data-filter="personal">Personal</button>
        <button class="chip" data-filter="ideas">Ideas</button>
        <button class="chip" data-filter="todo">To‚Äëdo</button>
      </div>

      <div class="date-filter smart-calendar-container">
        <label for="date-filter" class="date-filter-label">Date</label>
        <div class="date-input-wrapper">
          <input type="date" id="date-filter" class="date-filter-input" aria-label="Select note date" />
          <button class="calendar-icon-btn" id="calendar-toggle" aria-label="Toggle calendar">
            <div class="cal-icon-header" id="cal-icon-month">JAN</div>
            <div class="cal-icon-body" id="cal-icon-day">01</div>
          </button>
        </div>
        <button class="btn tiny ghost" type="button" id="clear-date" aria-label="Clear date filter">
          Clear
        </button>
        <!-- Custom Calendar Popup -->
        <div class="smart-calendar-popup hidden" id="smart-calendar">
          <div class="real-time-date-display" id="real-time-date-display"></div>

          <div class="calendar-header">
            <button class="cal-nav-btn" id="cal-prev">‚Üê</button>
            <span class="cal-current-month" id="cal-month-year">December 2025</span>
            <button class="cal-nav-btn" id="cal-next">‚Üí</button>
          </div>
          <div class="calendar-grid" id="calendar-grid">
            <!-- Days will be injected here -->
          </div>
          <div class="calendar-footer">
            <button class="btn tiny ghost" id="cal-today">Today</button>
          </div>
        </div>
      </div>

      <div class="header-tools">
        <button class="btn tiny ghost" id="edit-undo" type="button" aria-label="Undo"><span
            aria-hidden="true">‚Ü∫</span></button>
        <button class="btn tiny ghost" id="edit-redo" type="button" aria-label="Redo"><span
            aria-hidden="true">‚Üª</span></button>

        <select id="theme-selector" class="select tiny" aria-label="UI Theme">
          <option value="amoled-dark">AMOLED Dark</option>
          <option value="professional-light">Professional Light</option>
          <option value="corporate-gray">Corporate Gray</option>
          <option value="minimal-white">Minimal White</option>
        </select>
        <div class="auto-save-wrapper" style="display: flex; align-items: center; margin-right: 10px;">
          <input type="checkbox" id="auto-save-toggle" class="checkbox" style="margin-right: 5px;">
          <label for="auto-save-toggle" style="font-size: 14px; color: var(--text-color); cursor: pointer;">Auto
            Save</label>
        </div>
        <button class="btn primary" id="new-note">New note</button>
      </div>
    </div>
  </header>

  <main class="layout">
    <!-- Sidebar Column -->
    <aside class="sidebar-column">
      <!-- Main Notes Drawer -->
      <div class="sidebar">
        <div class="sidebar-header">
          <h2 class="section-title">Notes</h2>
          <div class="sort">
            <label for="sort">Sort</label>
            <select id="sort" class="select">
              <option value="updated_desc">Recent</option>
              <option value="updated_asc">Oldest</option>
              <option value="title_asc">Title A‚ÄìZ</option>
              <option value="title_desc">Title Z‚ÄìA</option>
            </select>
          </div>
        </div>

        <!-- Folders Section -->
        <div class="folders-section">
          <div class="folders-header">
            <h3>üìÅ Folders</h3>
            <button id="create-folder" class="btn-icon" title="Create new folder">+</button>
          </div>
          <ul id="folders-list" class="folders-list">
            <!-- Folders will be rendered here -->
          </ul>
        </div>

        <!-- Notes Section -->
        <div class="notes-section">
          <div class="notes-header">
            <h3>üìù Notes</h3>
          </div>

          <ul class="notes-list" id="notes-list">
            <li class="note-item active" data-tags="work, todo">
              <button class="note-card">
                <div class="note-meta">
                  <h3 class="note-title">Project roadmap</h3>
                  <time class="note-time" datetime="2025-11-19">Nov 19, 2025</time>
                </div>
                <p class="note-preview">Milestones, risks, and timelines for Q4 delivery‚Ä¶</p>
                <div class="tag-row">
                  <span class="tag">work</span>
                  <span class="tag">todo</span>
                </div>
              </button>
            </li>

            <li class="note-item" data-tags="ideas">
              <button class="note-card">
                <div class="note-meta">
                  <h3 class="note-title">App name brainstorm</h3>
                  <time class="note-time" datetime="2025-11-15">Nov 15, 2025</time>
                </div>
                <p class="note-preview">Short, memorable names; consider Gujarati words‚Ä¶</p>
                <div class="tag-row">
                  <span class="tag">ideas</span>
                </div>
              </button>
            </li>
          </ul>
        </div>
      </div>

      <!-- Sidebar Widgets Container -->
      <div class="sidebar-widgets-container">

        <!-- AI Assistant Widget -->
        <div class="ai-sidebar-widget">
          <div class="ai-widget-header">
            <h3>‚ú® AI Assistant</h3>
          </div>
          <div class="ai-input-wrapper">
            <textarea id="ai-sidebar-prompt" class="ai-widget-input" placeholder="Ask AI to write..."></textarea>

          </div>
          <button id="ai-sidebar-generate" class="btn primary full-width">Generate</button>
        </div>

        <!-- Mail Widget -->
        <div class="ai-sidebar-widget">
          <div class="ai-widget-header">
            <h3>‚úâÔ∏è Mailing</h3>
          </div>
          <div class="ai-input-wrapper" style="margin-bottom: 8px;">
            <input type="email" id="sidebar-mail-sender" class="ai-widget-input" placeholder="Your Email"
              style="height: 36px;">
          </div>
          <div class="ai-input-wrapper" style="margin-bottom: 8px;">
            <input type="email" id="sidebar-mail-recipient" class="ai-widget-input" placeholder="Recipient's Email"
              style="height: 36px;">
          </div>
          <div class="ai-input-wrapper">
            <textarea id="sidebar-mail-prompt" class="ai-widget-input"
              placeholder="Describe the mail you want to write..."></textarea>
          </div>
          <button id="sidebar-mail-send" class="btn primary full-width" style="margin-top: 8px;">Done</button>
        </div>

      </div>
    </aside>

    <!-- Editor: note details -->
    <section class="editor">
      <header class="editor-bar">
        <input type="text" class="title-input" id="title" placeholder="Untitled note" aria-label="Note title" />

        <div class="editor-actions">
          <div class="tags-input">
            <div class="tags-chips" id="tags">
              <!-- Tags will be injected here -->
            </div>
            <div class="tag-manager-container">
              <button class="btn-icon circular" id="add-tag-btn" aria-label="Add tag" title="Add tag">
                <span>+</span>
              </button>

              <!-- Tag Menu Popover -->
              <div id="tag-menu" class="tag-menu-popover hidden">
                <div class="tag-menu-header">
                  <input type="text" id="tag-search" placeholder="Search tags..." aria-label="Search tags"
                    autocomplete="off">
                </div>
                <div class="tag-menu-list" id="tag-menu-list">
                  <!-- Tag options will be injected here -->
                </div>
                <div class="tag-menu-footer">
                  <button class="btn tiny ghost full-width" id="create-new-tag-btn">
                    + Create new label
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="buttons">
            <button class="btn secondary" id="share-note" aria-label="Share note">Share</button>
            <button class="btn" id="duplicate-note">Duplicate</button>
            <button class="btn danger" id="delete-note">Delete</button>
            <button class="btn primary" id="save-note" aria-label="Save note"><span
                aria-hidden="true">üíæ</span></button>
          </div>
        </div>
      </header>

      <div class="editor-body">
        <div class="editor-toolbar" aria-label="Text formatting controls">
          <div class="toolbar-controls">
            <div class="toolbar-group">
              <label for="text-size" class="text-size-label">Size:</label>
              <select id="text-size" class="select tiny" aria-label="Text size">
                <option value="12">12 px</option>
                <option value="13">13 px</option>
                <option value="14">14 px</option>
                <option value="15" selected>15 px</option>
                <option value="16">16 px</option>
                <option value="17">17 px</option>
                <option value="18">18 px</option>
                <option value="19">19 px</option>
                <option value="20">20 px</option>
                <option value="21">21 px</option>
                <option value="22">22 px</option>
                <option value="23">23 px</option>
                <option value="24">24 px</option>
              </select>
            </div>

            <div class="toolbar-group">
              <label for="text-color" class="text-size-label">Color:</label>
              <select id="text-color" class="select tiny" aria-label="Text color">
                <option value="" selected>Default</option>
                <option value="#000000">Black</option>
                <option value="#2d3436">Dark gray</option>
                <option value="#ff6b6b">Red</option>
                <option value="#45b7d1">Blue</option>
                <option value="#96ceb4">Green</option>
                <option value="#dda0dd">Purple</option>
              </select>
              <input type="color" id="custom-text-color" class="color-picker-tiny" title="Custom color" />
            </div>

            <div class="toolbar-group">
              <label for="highlight-color" class="text-size-label">Highlight:</label>
              <select id="highlight-color" class="select tiny" aria-label="Highlight color">
                <option value="" selected>None</option>
                <option value="#FFFF00">Neon Yellow</option>
                <option value="#39FF14">Neon Green</option>
                <option value="#00FFFF">Cyan</option>
                <option value="#FF00FF">Magenta</option>
                <option value="#FF5F1F">Neon Orange</option>
                <option value="#FF69B4">Hot Pink</option>
              </select>
            </div>

            <div class="toolbar-group">
              <label for="note-theme" class="text-size-label">Card:</label>
              <select id="note-theme" class="select tiny" aria-label="Note card theme">
                <option value="classic-blue">Classic Blue</option>
                <option value="elegant-purple">Elegant Purple</option>
                <option value="forest-green">Forest Green</option>
                <option value="sunset-orange">Sunset Orange</option>
                <option value="ocean-teal">Ocean Teal</option>
                <option value="rose-gold">Rose Gold</option>
                <option value="slate-gray">Slate Gray</option>
                <option value="crimson-red">Crimson Red</option>
              </select>
            </div>



            <div class="toolbar-group">
              <label for="editor-pattern" class="text-size-label">Background:</label>
              <select id="editor-pattern" class="select tiny" aria-label="Editor background pattern">
                <option value="plain">Plain</option>
                <option value="lined">Lined</option>
                <option value="grid">Grid</option>
                <option value="dotted">Dotted</option>
                <option value="blueprint">Blueprint</option>
                <option value="sunset">Sunset</option>
                <option value="mint">Mint</option>
                <option value="lavender">Lavender</option>
              </select>
            </div>

            <select id="format-action" class="select tiny" aria-label="Text formatting">
              <option value="">Format</option>
              <option value="bold">Bold</option>
              <option value="italic">Italic</option>
              <option value="underline">Underline</option>
              <option value="strikethrough">Strikethrough</option>
              <option value="alignLeft">Align Left</option>
              <option value="alignCenter">Align Center</option>
              <option value="alignRight">Align Right</option>
              <option value="bullet">Bullet List</option>
            </select>
            <select id="edit-action" class="select tiny" aria-label="Edit actions">
              <option value="">Edit</option>
              <option value="cut">Cut</option>
              <option value="copy">Copy</option>
              <option value="paste">Paste</option>
            </select>
            <select id="insert-action" class="select tiny" aria-label="Insert content">
              <option value="">Insert</option>
              <option value="photo-video">Choose Photo or Video</option>
              <option value="audio">Record Audio</option>
              <option value="file">Attach File</option>
              <option value="sketch">Add Sketch</option>
              <option value="shapes">Shapes</option>
              <option value="table">Table</option>
            </select>
            <!-- Hidden inputs for triggers -->
            <input type="file" id="media-upload-input" accept="image/*,video/*" hidden />
            <input type="file" id="file-upload-input" hidden />
          </div>
          <button class="btn-icon tiny" id="toolbar-toggle" aria-label="Toggle toolbar">‚ñ≤</button>
        </div>
        <div id="content" class="editor-content" contenteditable="true" aria-label="Note content">
          <!-- Text will go here -->
        </div>
      </div>
    </section>
  </main>


  <!-- Profile Modal -->
  <dialog id="profile-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>User Profile</h2>
        <button class="btn-icon close-modal" aria-label="Close modal">√ó</button>
      </div>
      <div class="profile-body">
        <div class="profile-header">
          <div class="avatar-wrapper">
            <img id="profile-avatar-large" src="" alt="Profile Picture" class="profile-avatar-large">
            <button class="btn tiny secondary edit-avatar-btn" id="change-avatar-btn">Change</button>
            <input type="file" id="avatar-upload" accept="image/*" hidden>
          </div>
          <div class="profile-info">
            <h3 id="profile-username"></h3>
            <span class="member-since" id="member-since">Joined: December 2025</span>
          </div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <span class="stat-value" id="stat-total-notes">0</span>
            <span class="stat-label">Total Notes</span>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="stat-words">0</span>
            <span class="stat-label">Words Written</span>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="stat-last-active">Never</span>
            <span class="stat-label">Last Active</span>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Audio Recorder Modal -->
  <dialog id="audio-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Record Audio</h2>
        <button class="btn-icon close-modal">√ó</button>
      </div>
      <div class="audio-body">
        <div class="audio-visualizer" id="audio-visualizer">
          <!-- Simple waveform visualization -->
          <div class="wave"></div>
          <div class="wave"></div>
          <div class="wave"></div>
          <div class="wave"></div>
          <div class="wave"></div>
          <div class="wave"></div>
          <div class="wave"></div>
          <div class="wave"></div>
        </div>
        <div class="audio-controls">
          <button class="btn primary" id="start-record-btn">Record</button>
          <button class="btn danger" id="stop-record-btn" disabled>Stop</button>
        </div>
        <div class="audio-status" id="audio-status">Ready to record</div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary close-modal">Cancel</button>
        <button class="btn primary" id="save-audio-btn" disabled>Insert Audio</button>
      </div>
    </div>
  </dialog>

  <!-- Sketch Pad Modal -->
  <dialog id="sketch-modal" class="modal large">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Sketch</h2>
        <button class="btn-icon close-modal">√ó</button>
      </div>
      <div class="sketch-body">
        <canvas id="sketch-canvas" width="600" height="400"></canvas>
        <div class="sketch-tools">
          <button class="btn tiny active" id="tool-pen">Pen</button>
          <button class="btn tiny" id="tool-eraser">Eraser</button>
          <div class="divider-vertical"></div>
          <button class="btn tiny" id="sketch-undo" title="Undo">‚Ü∫</button>
          <button class="btn tiny" id="sketch-redo" title="Redo">‚Üª</button>
          <div class="divider-vertical"></div>
          <input type="color" id="sketch-color" value="#000000" title="Color">
          <input type="range" id="sketch-size" min="1" max="20" value="2" title="Size">
          <button class="btn tiny danger" id="tool-clear">Clear</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary close-modal">Cancel</button>
        <button class="btn primary" id="save-sketch-btn">Insert Sketch</button>
      </div>
    </div>
  </dialog>

  <!-- Shapes Modal -->
  <dialog id="shapes-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Insert Shape</h2>
        <button class="btn-icon close-modal">√ó</button>
      </div>
      <div class="shapes-body">
        <div class="shapes-grid">
          <button class="shape-btn" data-shape="rectangle" aria-label="Rectangle">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" fill="none" stroke-width="2" />
            </svg>
            <span>Rectangle</span>
          </button>
          <button class="shape-btn" data-shape="circle" aria-label="Circle">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <circle cx="12" cy="12" r="9" stroke="currentColor" fill="none" stroke-width="2" />
            </svg>
            <span>Circle</span>
          </button>
          <button class="shape-btn" data-shape="triangle" aria-label="Triangle">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path d="M12 4L21 20H3L12 4Z" stroke="currentColor" fill="none" stroke-width="2" />
            </svg>
            <span>Triangle</span>
          </button>
          <button class="shape-btn" data-shape="star" aria-label="Star">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"
                stroke="currentColor" fill="none" stroke-width="2" />
            </svg>
            <span>Star</span>
          </button>
          <button class="shape-btn" data-shape="arrow-right" aria-label="Arrow">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" fill="none" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>Arrow</span>
          </button>
          <button class="shape-btn" data-shape="line" aria-label="Line">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <line x1="3" y1="12" x2="21" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
            <span>Line</span>
          </button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary close-modal">Cancel</button>
      </div>
    </div>
  </dialog>


  <!-- Custom Tag Creation Modal -->
  <dialog id="custom-tag-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create new label</h2>
        <button class="btn-icon close-modal">√ó</button>
      </div>
      <div class="modal-body" style="padding: 20px;">
        <div class="form-group" style="margin-bottom: 20px; display: flex; justify-content: center;">
          <div class="label-preview-container">
            <span class="tag" style="font-size: 14px; padding: 6px 16px;" id="new-tag-preview">Label preview</span>
          </div>
        </div>

        <div class="form-group" style="margin-bottom: 16px;">
          <label for="new-tag-name" style="display: block; margin-bottom: 8px; font-weight: 500;">Name</label>
          <input type="text" id="new-tag-name" class="search-input"
            style="width: 100%; border: 1px solid var(--border);" placeholder="Label name" maxlength="20">
        </div>

        <div class="form-group" style="margin-bottom: 16px;">
          <label for="new-tag-desc" style="display: block; margin-bottom: 8px; font-weight: 500;">Description
            (optional)</label>
          <input type="text" id="new-tag-desc" class="search-input"
            style="width: 100%; border: 1px solid var(--border);" placeholder="Description">
        </div>

        <div class="form-group" style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500;">Color</label>
          <div class="color-options" id="new-tag-colors"
            style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 8px;">
            <!-- Color swatches generated by JS -->
          </div>
          <div class="custom-color-input" style="display: flex; align-items: center; gap: 8px;">
            <input type="color" id="new-tag-color-picker"
              style="width: 36px; height: 36px; padding: 0; border: none; background: none; cursor: pointer;">
            <span id="new-tag-color-hex" style="font-family: monospace; color: var(--text-dim);">#000000</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary close-modal">Cancel</button>
        <button class="btn primary" id="save-new-tag-btn">Create label</button>
      </div>
    </div>
  </dialog>

  <!-- Share Modal -->
  <dialog id="share-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Share Note</h2>
        <button class="btn-icon close-modal">√ó</button>
      </div>
      <div class="share-body"
        style="display: flex; flex-direction: column; align-items: stretch; gap: 15px; padding: 25px;">

        <p style="text-align: center; color: var(--text-muted); margin-bottom: 5px;">
          Share this note directly as text via:
        </p>

        <a id="share-whatsapp" href="#" target="_blank" class="btn full-width"
          style="background-color: #25D366; color: white; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; border: none;">
          <span style="font-size: 1.2em;">üí¨</span> Share on WhatsApp
        </a>

        <a id="share-email" href="#" class="btn full-width"
          style="background-color: #EA4335; color: white; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; border: none;">
          <span style="font-size: 1.2em;">‚úâÔ∏è</span> Share via Email
        </a>

        <div style="height: 1px; background: var(--border); margin: 5px 0;"></div>

        <button id="share-copy-text" class="btn secondary full-width"
          style="display: flex; align-items: center; justify-content: center; gap: 10px;">
          <span style="font-size: 1.2em;">üìã</span> Copy Text to Clipboard
        </button>

      </div>
      <div class="modal-footer">
        <button class="btn secondary close-modal">Close</button>
      </div>
    </div>
  </dialog>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script type="text/javascript" src="JS/vendor/lz-string.min.js"></script>
  <script type="text/javascript" src="JS/vendor/qrcode.min.js"></script>
  <script type="module" src="JS/notesApp.js?v=2.2"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker Registered'))
        .catch((err) => console.log('SW Registration Failed', err));
    }
  </script>
</body>

</html>